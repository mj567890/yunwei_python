<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®åº“æµ‹è¯• - ITè¿ç»´ç³»ç»Ÿ</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .btn { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .btn:hover { background: #0056b3; }
        .result { margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-family: monospace; white-space: pre-wrap; }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f2f2f2; }
        .status { padding: 2px 8px; border-radius: 4px; font-size: 12px; }
        .status-online { background: #d4edda; color: #155724; }
        .status-offline { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>ğŸ” ITè¿ç»´ç³»ç»Ÿ - æ•°æ®åº“æµ‹è¯•é¡µé¢</h1>
    
    <div class="section">
        <h2>ğŸ” ç”¨æˆ·è®¤è¯æµ‹è¯•</h2>
        <button class="btn" onclick="testLogin()">æµ‹è¯•ç™»å½• (admin/admin123)</button>
        <button class="btn" onclick="testProfile()">è·å–ç”¨æˆ·ä¿¡æ¯</button>
        <div id="auth-result" class="result"></div>
    </div>
    
    <div class="section">
        <h2>ğŸ“¦ èµ„äº§ç®¡ç†æµ‹è¯•</h2>
        <button class="btn" onclick="testAssets()">è·å–èµ„äº§åˆ—è¡¨</button>
        <button class="btn" onclick="testAddAsset()">æ–°å¢æµ‹è¯•èµ„äº§</button>
        <div id="asset-result" class="result"></div>
        <div id="asset-table"></div>
    </div>
    
    <div class="section">
        <h2>ğŸ“Š ç»Ÿè®¡æ•°æ®æµ‹è¯•</h2>
        <button class="btn" onclick="testStatistics()">è·å–ç»Ÿè®¡æ•°æ®</button>
        <div id="stats-result" class="result"></div>
    </div>
    
    <div class="section">
        <h2>ğŸ¥ ç³»ç»Ÿå¥åº·æ£€æŸ¥</h2>
        <button class="btn" onclick="testHealth()">æ£€æŸ¥åç«¯å¥åº·çŠ¶æ€</button>
        <div id="health-result" class="result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000';
        let authToken = null;

        function log(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = isError ? 'result error' : 'result success';
        }

        async function apiCall(endpoint, options = {}) {
            try {
                const url = `${API_BASE}${endpoint}`;
                const defaultOptions = {
                    headers: {
                        'Content-Type': 'application/json',
                        ...(authToken && { 'Authorization': `Bearer ${authToken}` })
                    }
                };
                
                const response = await fetch(url, { ...defaultOptions, ...options });
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${data.message || 'è¯·æ±‚å¤±è´¥'}`);
                }
                
                return data;
            } catch (error) {
                throw new Error(`ç½‘ç»œé”™è¯¯: ${error.message}`);
            }
        }

        async function testLogin() {
            try {
                const result = await apiCall('/api/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'admin123'
                    })
                });
                
                if (result.status === 'success') {
                    authToken = result.data.access_token;
                    log('auth-result', `âœ… ç™»å½•æˆåŠŸï¼\nç”¨æˆ·: ${result.data.user.real_name}\nToken: ${authToken.substring(0, 20)}...`);
                } else {
                    log('auth-result', `âŒ ç™»å½•å¤±è´¥: ${result.message}`, true);
                }
            } catch (error) {
                log('auth-result', `âŒ ç™»å½•æµ‹è¯•å¤±è´¥: ${error.message}`, true);
            }
        }

        async function testProfile() {
            try {
                const result = await apiCall('/api/auth/profile');
                log('auth-result', `âœ… ç”¨æˆ·ä¿¡æ¯è·å–æˆåŠŸï¼\n${JSON.stringify(result.data, null, 2)}`);
            } catch (error) {
                log('auth-result', `âŒ è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥: ${error.message}`, true);
            }
        }

        async function testAssets() {
            try {
                const result = await apiCall('/api/assets');
                log('asset-result', `âœ… èµ„äº§æ•°æ®è·å–æˆåŠŸï¼\næ€»æ•°: ${result.data.total} æ¡è®°å½•`);
                
                // æ˜¾ç¤ºèµ„äº§è¡¨æ ¼
                displayAssetsTable(result.data.items);
            } catch (error) {
                log('asset-result', `âŒ è·å–èµ„äº§æ•°æ®å¤±è´¥: ${error.message}`, true);
            }
        }

        async function testAddAsset() {
            try {
                // è¿™é‡Œæ¨¡æ‹Ÿæ·»åŠ èµ„äº§çš„APIè°ƒç”¨ï¼ˆéœ€è¦åç«¯å®ç°ï¼‰
                const assetData = {
                    asset_code: `TEST${Date.now()}`,
                    name: 'æµ‹è¯•èµ„äº§',
                    brand: 'æµ‹è¯•å“ç‰Œ',
                    model: 'æµ‹è¯•å‹å·',
                    category: 'æµ‹è¯•ç±»åˆ«',
                    status: 'åœ¨ç”¨'
                };
                
                log('asset-result', `ğŸ“ å‡†å¤‡æ·»åŠ èµ„äº§: ${JSON.stringify(assetData, null, 2)}\n\nâš ï¸ æ³¨æ„ï¼šæ·»åŠ èµ„äº§åŠŸèƒ½éœ€è¦åç«¯å®ç° POST /api/assets æ¥å£`);
            } catch (error) {
                log('asset-result', `âŒ æ·»åŠ èµ„äº§å¤±è´¥: ${error.message}`, true);
            }
        }

        function displayAssetsTable(assets) {
            const tableDiv = document.getElementById('asset-table');
            if (!assets || assets.length === 0) {
                tableDiv.innerHTML = '<p>æš‚æ— èµ„äº§æ•°æ®</p>';
                return;
            }

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>èµ„äº§ç¼–ç </th>
                            <th>èµ„äº§åç§°</th>
                            <th>å“ç‰Œ</th>
                            <th>å‹å·</th>
                            <th>ç±»åˆ«</th>
                            <th>çŠ¶æ€</th>
                            <th>ä½¿ç”¨äºº</th>
                            <th>éƒ¨é—¨</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            assets.forEach(asset => {
                html += `
                    <tr>
                        <td>${asset.asset_code || '-'}</td>
                        <td>${asset.name || '-'}</td>
                        <td>${asset.brand || '-'}</td>
                        <td>${asset.model || '-'}</td>
                        <td>${asset.category || '-'}</td>
                        <td><span class="status ${asset.status === 'åœ¨ç”¨' ? 'status-online' : 'status-offline'}">${asset.status || '-'}</span></td>
                        <td>${asset.user_name || '-'}</td>
                        <td>${asset.user_department || '-'}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            tableDiv.innerHTML = html;
        }

        async function testStatistics() {
            try {
                const result = await apiCall('/api/statistics/overview');
                log('stats-result', `âœ… ç»Ÿè®¡æ•°æ®è·å–æˆåŠŸï¼\n${JSON.stringify(result.data, null, 2)}`);
            } catch (error) {
                log('stats-result', `âŒ è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥: ${error.message}`, true);
            }
        }

        async function testHealth() {
            try {
                const result = await apiCall('/api/health');
                log('health-result', `âœ… ç³»ç»Ÿå¥åº·æ£€æŸ¥é€šè¿‡ï¼\n${JSON.stringify(result, null, 2)}`);
            } catch (error) {
                log('health-result', `âŒ ç³»ç»Ÿå¥åº·æ£€æŸ¥å¤±è´¥: ${error.message}`, true);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        window.onload = function() {
            testHealth();
        };
    </script>
</body>
</html>